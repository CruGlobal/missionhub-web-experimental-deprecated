<md-card class="timeline-card actions-card">
  <div layout="row" layout-align="space-between center">
    <md-button class="md-accent">
      <ng-md-icon icon="people"></ng-md-icon>
      Add Interaction
    </md-button>
    <md-button class="md-accent">
      <ng-md-icon icon="send"></ng-md-icon>
      Send New Message
    </md-button>
    <md-button class="md-accent">
      <ng-md-icon icon="assignment"></ng-md-icon>
      Input Survey Answers
    </md-button>
  </div>
</md-card>
<md-card class="timeline-card" ng-repeat="event in timeline.events | orderBy : '-timestamp'">
  <div class="timeline-header" layout="row" layout-align="start center">
    <div class="timeline-badge md-primary">
      <div class="badge-day">{{timeline.moment(event.timestamp).format('D')}}</div>
      <div class="badge-month">{{timeline.moment(event.timestamp).format('MMM')}}</div>
    </div>
    <h4 ng-switch="event.eventType" ng-if="!event.edit">
      <ng-md-icon ng-switch-when="interaction" icon="people"></ng-md-icon>
      <ng-md-icon ng-switch-when="message" icon="email"></ng-md-icon>
      <ng-md-icon ng-switch-when="survey" icon="assignment"></ng-md-icon>
      <span ng-switch-when="interaction">
        {{event.type}}
      </span>
      <span ng-switch-when="message">
        {{event.sent_via | capitalize}}
      </span>
      <span ng-switch-when="survey">
        {{event.surveyType}}
      </span>
      <small>
        <span ng-switch-when="interaction">
          with
          <span ng-repeat-start="initiator in event.initiators" ng-if="$last && !$first"> and</pre></span>
          <span ng-repeat-end><a ui-sref="people.card({personId: initiator.id})">{{initiator.name}}</a>{{!$last && event.initiators.length > 2 ? ',' : ''}}</span>
        </span>
        <span ng-switch-when="message">
          from
          <a ui-sref="people.card({personId: event.sender.id})">{{event.sender.name}}</a>
        </span>
        <span ng-switch-when="survey">TODO: does this need/have a initiator?</span>
      </small>
    </h4>
    <div ng-if="event.edit" layout="row" layout-align="start center">
      <md-input-container class="remove-padding">
        <label>Type</label>
        <md-select ng-model="event.type">
          <md-option ng-value="type" ng-repeat="type in timeline.interactionTypes">{{type}}</md-option>
        </md-select>
      </md-input-container>
      <h4>
        <small>with {{event.initiator}}</small>
      </h4>
    </div>
    <span flex></span>
    <md-button class="md-icon-button" aria-label="Edit" ng-click="event.edit=true" ng-if="!event.edit">
      <ng-md-icon icon="edit"></ng-md-icon>
    </md-button>
    <md-button class="md-icon-button" aria-label="Save" ng-click="event.edit=false" ng-if="event.edit">
      <ng-md-icon icon="save"></ng-md-icon>
    </md-button>
  </div>
  <md-card-content ng-switch="event.eventType">
    <p ng-if="!event.edit">
      <small class="text-muted">
        <i class="glyphicon glyphicon-time"></i>
        Created {{timeline.moment(event.created_at).fromNow()}}
        - Visible to everyone in {{event.organization.name}}
        <span ng-if="event.creator"> - Created by <a ui-sref="people.card({personId: event.creator.id})">{{event.creator.name}}</a></span>
      </small>
    </p>
    <div ng-if="event.edit">
      <md-datepicker ng-model="event.time"></md-datepicker>
    </div>
    <div ng-switch-when="interaction" ng-if="!event.edit">{{event.comment}}</div>
    <md-input-container ng-switch-when="interaction" ng-if="event.edit">
      <label>Comment</label>
      <textarea ng-model="event.comment"></textarea>
    </md-input-container>
    <div ng-switch-when="message">
      <md-list class="message-container md-whiteframe-1dp">
        <md-list-item layout="row" layout-align="space-between">
          <div ng-if="event.subject">
            <strong class="heading-space">Subject:</strong>
            {{event.subject}}
          </div>
          <div ng-if="event.to">
            <strong class="heading-space">To:</strong>
            <span ng-if="event.sent_via == 'email'">{{event.to}}</span>
            <span ng-if="event.sent_via == 'sms'">{{event.to | phone}}</span>
          </div>
          <div ng-if="event.from">
            <strong class="heading-space">From:</strong>
            {{event.from}}
          </div>
        </md-list-item>
        <md-divider></md-divider>
        <md-list-item class="pre-message">{{event.message}}</md-list-item>
      </md-list>
    </div>
    <div ng-switch-when="survey">
      <dl class="dl-horizontal">
        <dt ng-repeat-start="surveyQuestion in event.survey">{{surveyQuestion.question}}</dt>
        <dd ng-repeat-end>{{surveyQuestion.answer}}</dd>
      </dl>
    </div>
  </md-card-content>
</md-card>
